---
title: 'Simulate Conversation'
sidebarTitle: "Simulate"
description: "Run a full conversation simulation between your agent and a synthetic user using the Galtea SDK."
---

## Returns
It returns a result object from the [Conversation Simulator](/concepts/product/test/case/conversation-simulator#simulation-result-structure) containing the complete conversation history, status, and metadata. This is used to analyze how your agent performed in the test scenario.

## Agent Options

Provide your agent as a plain function with one of three supported signatures:

- **Simple** — `(user_message: str) -> str` — receives just the last user message
- **Chat History** — `(messages: list[dict]) -> str` — receives the full conversation history in the OpenAI message standard format (`{"role": "...", "content": "..."}`) 
- **Structured** — `(input_data: AgentInput) -> AgentResponse` — structured input/output with access to session context, helper methods, and optional usage/cost tracking

Both sync and async functions are supported.

## Example

```python
# Simple: receives just the last user message
def my_agent(user_message: str) -> str:
    return f"Response to: {user_message}"


# Chat History: receives the full conversation history (OpenAI message format)
def my_agent(messages: list[dict]) -> str:
    return f"Response to: {messages[-1]['content']}"


# Structured: structured input/output (with usage/cost tracking and retrieval context)
def my_agent(input_data: galtea.AgentInput) -> galtea.AgentResponse:
    user_msg = input_data.last_user_message_str()
    return galtea.AgentResponse(
        content=f"Response to: {user_msg}",
        usage_info={"input_tokens": 100, "output_tokens": 50},
    )


# Async functions work too
async def my_async_agent(user_message: str) -> str:
    return f"Async response to: {user_message}"


result = galtea_client.simulator.simulate(
    session_id=session_id,
    agent=my_agent,
    max_turns=10,
)
```

## Parameters

<ResponseField name="session_id" type="str" required>
  The session identifier for this simulation.
</ResponseField>

<ResponseField name="agent" type="AgentType" required>
  The agent function that generates responses. Supported signatures:
  - **Simple:** `(user_message: str) -> str` — receives last user message
  - **Chat History:** `(messages: list[dict]) -> str` — receives full chat history (OpenAI format)
  - **Structured:** `(input_data: AgentInput) -> AgentResponse` — structured input/output
  
  Both sync and async functions are supported. Use the structured signature when you need `usage_info`, `cost_info`, or `retrieval_context`.
</ResponseField>

<ResponseField name="max_turns" type="int">
  Maximum number of conversation turns. Defaults to the Test Case's max turns if not provided.
</ResponseField>

<ResponseField name="log_inference_results" type="bool">
  Whether to log inference results to the platform. Default: True
</ResponseField>

<ResponseField name="enable_last_inference" type="bool">
  Whether to call your agent one final time after the simulated user sends their last message. Default: True.
  When enabled, your agent will have the opportunity to respond to the conversation's final user message, ensuring complete dialogue coverage for evaluation purposes.
</ResponseField>

<ResponseField name="include_metadata" type="bool">
  Whether to include metadata in the simulation result. Default: False
</ResponseField>

<ResponseField name="agent_goes_first" type="bool">
  If True, the agent will generate the first message before any user messages are generated. Default: False
  <Note>
    When `agent_goes_first` is set to `True`:
    - Any `input` (first user message) defined on the associated `TestCase` will be ignored.
    - The first call to your agent will have an empty `messages` list in the `AgentInput`. Ensure your agent function can handle cases where `input_data.last_user_message_str()` returns `None` (or the messages list is empty).
  </Note>
</ResponseField>

<ResponseField name="stop_when_agent_returns_empty_response" type="bool">
  If True, the simulation will stop when the agent returns an empty (`""` / `None`) response. Default: True
  <Note>
    When `stop_when_agent_returns_empty_response` is set to `False`:
    - The simulation will continue even if the agent returns a response that is empty (`""`) or `None`.
    - This allows for more flexible conversation flows where you want to capture all agent interactions regardless of content.
    - Be careful when using this option, as it may lead to further credit consumption if the agent keeps returning empty responses. To mitigate this, you can also make use of the `max_turns` parameter to set an upper limit on the number of turns.
  </Note>
</ResponseField>
