---
title: 'Trace Service'
sidebarTitle: "Service"
description: "Trace Service API methods in the Galtea SDK"
---

import TraceCard from '/snippets/cards/trace-card.mdx';

The Trace Service in the Galtea SDK allows you to collect, manage, and persist [traces](/concepts/product/version/session/trace) that capture the internal operations of your AI agents during inference.

This Service is exposed by the `galtea.traces` object.

<Info>
  Remember that we will be using the `galtea` object. More information [here](/sdk/api/galtea).
</Info>

## Two Approaches to Trace Collection

The SDK provides two ways to collect traces:

### 1. Automatic Collection with OpenTelemetry (Recommended)

Use the `@trace` decorator or `start_trace()` context manager with context management:

```python
from galtea import Galtea, trace, set_context, clear_context, TraceType

galtea = Galtea(api_key="YOUR_API_KEY")

@trace(type=TraceType.TOOL)
def fetch_user_data(user_id: str) -> dict:
    return {"name": "John Doe", "email": "john@example.com"}

@trace(type=TraceType.GENERATION)
def generate_response(prompt: str) -> str:
    return "Generated response..."

# Set context before running traced functions
inference_result = galtea.inference_results.create(session_id=session.id, input="...")
token = set_context(inference_result_id=inference_result.id)

try:
    user = fetch_user_data("user_123")
    response = generate_response("Hello")
finally:
    clear_context(token)  # Flushes traces to Galtea
```

### 2. Fully Automatic with `generate()`

When using `galtea.inference_results.generate()`, trace collection is handled automatically:

```python
# Traces are collected, saved, and cleaned up automatically
inference_result = galtea.inference_results.generate(
    agent=my_agent,
    session=session,
    user_input="What's the price?"
)
```

### 3. Manual Collection with Context Management

For full control over the trace lifecycle, use `set_context()` and `clear_context()`:

```python
from galtea import Galtea, trace, set_context, clear_context, TraceType

galtea = Galtea(api_key="YOUR_API_KEY")

@trace(type=TraceType.RETRIEVER)
def search_docs(query: str):
    return [{"doc": "relevant content"}]

@trace(type=TraceType.GENERATION)
def generate(context):
    return "Generated response"

# 1. Create inference result first
inference_result = galtea.inference_results.create(
    session_id="YOUR_SESSION_ID",
    input="What is pricing?"
)

# 2. Set context to associate traces with the inference result
token = set_context(inference_result_id=inference_result.id)

try:
    # 3. Execute traced operations
    context = search_docs("What is pricing?")
    response = generate(context)
    
    # 4. Update inference result with output
    galtea.inference_results.update(
        inference_result_id=inference_result.id,
        output=response
    )
finally:
    # 5. Clear context and flush traces to Galtea
    clear_context(token)  # flush=True by default
```

<Tip>
  Use `galtea.inference_results.generate()` for automatic trace collection instead of manual collection.
</Tip>

## Service Methods

### Context Management
- [@trace Decorator](/sdk/api/trace/trace-decorator)
- [start_trace](/sdk/api/trace/start-trace)
- [set_context](/sdk/api/trace/set-context)
- [clear_context](/sdk/api/trace/clear-context)

### Direct API Methods
- [Create Trace](/sdk/api/trace/create)
- [Create Trace Batch](/sdk/api/trace/create-batch)
- [List Traces](/sdk/api/trace/list)
- [Get Trace](/sdk/api/trace/get)
- [Delete Trace](/sdk/api/trace/delete)

## Related Concepts

<TraceCard />
